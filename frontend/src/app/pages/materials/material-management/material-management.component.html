<div class="material-management-container">
  <h2>Material Management</h2>

  <h3>{{ editingMaterial ? 'Edit Material' : 'Add New Material' }}</h3>
  <div class="material-form">
    <div *ngIf="editingMaterial">
      <label for="id">ID:</label>
      <input type="text" id="id" [(ngModel)]="currentMaterial.id" required>
    </div>
    <label for="type">Type:</label>
    <select id="type" [(ngModel)]="selectedType" (change)="handleTypeChange()" required>
      <option value="">-- Select Type --</option>
      <option value="__new__">Add New Type</option>
      <option *ngFor="let type of materialTypes" [value]="type">{{ type }}</option>
    </select>

    <div *ngIf="showNewTypeInput">
      <label for="newType">New Type Name:</label>
      <input type="text" id="newType" [(ngModel)]="newTypeName" required>
    </div>

    <label for="name">Name:</label>
    <input type="text" id="name" [(ngModel)]="currentMaterial.name" required>

    <label for="details">Details:</label>
    <textarea style="width: 100%;" id="details" [(ngModel)]="currentMaterial.details"></textarea>

    <label for="currentLocation">Initial Location:</label>
    <select id="currentLocation" [(ngModel)]="currentMaterial.currentLocation" required>
      <option value="">-- Select a Room --</option>
      <option *ngFor="let room of rooms" [value]="room.id">{{ room.name }}</option>
    </select>

    <div *ngIf="!editingMaterial">
      <label for="quantity">Quantity:</label>
      <input type="number" id="quantity" [(ngModel)]="newMaterial.quantity" min="1" [disabled]="showCustomIds">
    </div>

    <div *ngIf="!editingMaterial" class="form-group">
      <button style="background-color: blue;" type="button" (click)="toggleCustomIds()">
        {{ showCustomIds ? 'Hide Custom IDs' : 'Add Custom IDs' }}
      </button>
    </div>

    <div *ngIf="showCustomIds && !editingMaterial" class="custom-ids-section">
      <h3>Custom IDs</h3>
      <div class="id-input-mode-selection">
        <label>
          <input type="radio" name="idMode" [value]="'enumerated'" [(ngModel)]="idInputMode" (change)="selectIdInputMode('enumerated')" [ngModelOptions]="{standalone: true}">
          Enumerated IDs
        </label>
        <label>
          <input type="radio" name="idMode" [value]="'commaSeparated'" [(ngModel)]="idInputMode" (change)="selectIdInputMode('commaSeparated')" [ngModelOptions]="{standalone: true}">
          Comma Separated IDs
        </label>
      </div>

      <div *ngIf="idInputMode === 'enumerated'" class="form-group">
        <label for="idStart">Start ID (Enumerated):</label>
        <input type="number" id="idStart" [(ngModel)]="idStart" [ngModelOptions]="{standalone: true}" />
        <label for="idEnd">End ID (Enumerated):</label>
        <input type="number" id="idEnd" [(ngModel)]="idEnd" [ngModelOptions]="{standalone: true}" />
        <button type="button" (click)="addEnumeratedIds()">Add Enumerated IDs</button>
      </div>

      <div *ngIf="idInputMode === 'commaSeparated'" class="form-group">
        <label for="idCommas">Comma Separated IDs:</label>
        <input type="text" id="idCommas" [(ngModel)]="idCommas" [ngModelOptions]="{standalone: true}" />
        <button type="button" (click)="addCommaSeparatedIds()">Add Comma Separated IDs</button>
      </div>

      <div *ngIf="customIds.length > 0" class="added-ids">
        <h4>Added IDs:</h4>
        <ul>
          <li *ngFor="let id of customIds">{{ id }}</li>
        </ul>
        <button style="margin-bottom: 20px; background-color: red;" type="button" (click)="clearCustomIds()">Clear All Custom IDs</button>
      </div>
    </div>

    <button *ngIf="!editingMaterial" (click)="addMaterial()">Add Material</button>
    <button *ngIf="editingMaterial" (click)="updateMaterial()">Update Material</button>
    <button *ngIf="editingMaterial" (click)="cancelEdit()">Cancel</button>
  </div>

  <h3>Existing Materials</h3>

  <div class="filter-section">
    <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()" placeholder="Search materials..." class="search-input">

    <select [(ngModel)]="filterType" (change)="onFilterChange()">
      <option value="">All Types</option>
      <option *ngFor="let type of materialTypes" [value]="type">{{ type }}</option>
    </select>

    <select [(ngModel)]="filterAvailability" (change)="onFilterChange()">
      <option value="">All Statuses</option>
      <option value="true">Available</option>
      <option value="false">Reserved</option>
    </select>

    <select [(ngModel)]="filterLocation" (change)="onFilterChange()">
      <option value="">All Locations</option>
      <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
    </select>
  </div>

  <div class="material-list">
    <div class="material-item" *ngFor="let material of materials">
      <div>
        <h4>{{ material.name }} ({{ material.id }})</h4>
        <p>Type: {{ material.type }}</p>
        <p>Status: <span [class.available]="material.isAvailable" [class.reserved]="!material.isAvailable">{{ material.isAvailable ? 'Available' : 'Reserved' }}</span></p>
        <p>Location: {{ material.currentLocation }}</p>
      </div>
      <div class="actions">
        <button (click)="editMaterial(material)">Edit</button>
        <button (click)="deleteMaterial(material.id)">Delete</button>
      </div>
    </div>
  </div>

  <div class="pagination-controls">
    <button (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>
